---
title: "Proyecto Experimentos"
output: html_document
date: "2025-06-21"
---

```{r}
library(readxl)
```

#factor

```{r}
base_aguacates$temp=as.factor(base_aguacates$temp)
levels(base_aguacates$temp)=c("ambiente","refrigeradora","congelador") 
base_aguacates$semilla=factor(base_aguacates$semilla) 
levels(base_aguacates$semilla)=c("con semilla","sin semilla")
base_aguacates$bloque = as.factor(base_aguacates$bloque)
levels(base_aguacates$bloque)=c("g","m","j","a")
base_aguacates$bloque = as.factor(base_aguacates$bloque)

```


#número de repeticiones por tratamiento.

```{r}
table(base_aguacates$temp,base_aguacates$semilla)
```


*comparación de los gráficos Bloques*
```{r}
modprueba=lm(oxidación~bloque,data=base_aguacates) #fijo respuesta y bloque
pre=predict(modprueba)  #me da la media de cada bloque
t1=base_aguacates$oxidación-pre+mean(base_aguacates$oxidación)
```

```{r}
par(mfrow=c(1,2))
boxplot(oxidación~temp+semilla,ylim=c(0,6),xlab="temp",ylab="oxidación",data=base_aguacates)
boxplot(t1~temp+semilla,ylim=c(0,6),xlab="temp",
ylab="oxidacion centrada",data=base_aguacates)
```

*verificación de los supuestos (normalidad, homocedasticidad)*
si me dan normales o homocedasticos no debo de hacer ninguna correccion(bonfe, tuckey, etc)

$$
\mu_{ijk} = \mu + \alpha_i+\beta_j+(\alpha\beta)_{ij}+\delta_k\\
$$

$$
\mu_{ijk} = \mu + \alpha_1 T_1 + \alpha_2 T_2 + \beta_1 C_1 + (\alpha\beta)_{11} T_1 C_1 + (\alpha\beta)_{21} T_2 C_1 + \delta_k
$$

*Prueba de normalidad*

```{r}
car::qqPlot(mod1$res)
shapiro.test(mod1$res)
ks.test(mod1$residuals,"pnorm",mean=0,sd=sd(mod1$residuals))
```

Verificamos que sí hay normalidad tanto con la prueba de ks y con la shapiro

*intervalos de confianza necesario la diferencia relevante*
```{r}
TukeyHSD(aov(mod1))
plot(TukeyHSD(aov(mod1)))

```


*Prueba de homocedasticidad*

H0: hay homocedasticidad   H1: no hay homocedasticidad
```{r}
bartlett.test(residuals(mod)~interaction(temp,semilla),data=base_aguacates)
```
Sí hay homocedasticidad (no hay corrección)


*Verificación de la interacción*
ggplot de interacción
```{r}
library(ggplot2)
ggplot(base_aguacates,aes(x=semilla,y=oxidación, group= temp))+
  stat_summary(fun.y = "mean",geom="line", aes(linetype = temp))
```

paso a suma nula y modelo

*Prueba de interacción*

H0: (aB)ij=0  H1: (aB)ij!=0
```{r}
options(contrasts = c("contr.sum","contr.poly"))
mod= lm(oxidación~temp*semilla+bloque, data=base_aguacates)
anova(mod)
```

No hay interacción pero igual lo pruebo con la comparacion de medias obvservadas y estimadas
Solo interesa probar en esta etapa si existe interacción entre temperatura y semilla. No interesa probar los efectos simples si no se ha eliminado la interacción. La hipótesis es H0:(αβ)ij = 0. Esta hipótesis dice que el efecto de la temperatura del aguacate sobre la oxidación  promedio es independiente de si hay semilla o no, es decir, es el mismo sin importar la presencia de semilla o falta de esta.


```{r}
model.tables(aov(mod)) #efectos de interacción
```
```{r}
mediagen <- mean(base_aguacates$oxidación)#media general de oxidación
mediaobv <- tapply(base_aguacates$oxidación,list(base_aguacates$temp,base_aguacates$semilla),mean)#medias observadas y estimadas

alfa= tapply(base_aguacates$oxidación,base_aguacates$temp,mean)-mediagen
alfa

beta=tapply(base_aguacates$oxidación,base_aguacates$semilla,mean)-mediagen
beta

#mediaest= media general+a+B 
  
m11= mediagen+alfa[1]+beta[1] 
m21= mediagen+alfa[2]+beta[1]
m31= mediagen+alfa[3]+beta[1]
m12= mediagen+alfa[1]+beta[2]
m22= mediagen+alfa[2]+beta[2]
m32= mediagen+alfa[3]+beta[2]
  
mest= c(m11,m21,m31,m12,m22,m32)
mest
```
```{r}
#comparación
M=cbind(as.vector(mediaobv),mest)
colnames(M)= c("Observados","   Estimados sin interacción")
M

#necesitamos un diferencia mínima relevante (preguntar al experto)
```
Sigo corroborando que no hay interacción

____________________________________________________________________________________________

*me puedo pasar al modelo sin interacción*

#vuelvo a realizar las pruebas

#modelo sin interacción y bloque
```{r}
mod1= lm(oxidación~temp+semilla+bloque, data=base_aguacates)
anova(mod1)

#la varianza entre bloque es de 9,667 (por lo que no hay muchas diferencias de entre bloques)
```

#Homocedasticidad DUDA HAY 2

```{r}
bartlett.test(oxidación~interaction(temp,semilla),data=base_aguacates)
```

#Prueba de homocedasticidad

H0: hay homocedasticidad   H1: no hay homocedasticidad
```{r}
bartlett.test(residuals(mod1)~interaction(temp,semilla),data=base_aguacates)
```
Hay homocedasticidad

#Prueba de normalidad

```{r}
car::qqPlot(mod1$res)
shapiro.test(mod1$res)
ks.test(mod1$residuals,"pnorm",mean=0,sd=sd(mod1$residuals))
```

#intervalos de confianza necesario la diferencia relevante

```{r}
TukeyHSD(aov(mod1))
```
```{r}
plot(TukeyHSD(aov(mod1)))
```

Podemos usar los intervalos dados por la prueba de tukey (necesitamos la diferencia significativa o relevante)



# Potencia
```{r}
library(pwr)
power.anova.test(n= 12, groups = 6, between.var = 32.812, within.var = 0.643)
```

